
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Phoenix Build Tool - Max&#8217;s blog</title>
  <meta name="author" content="Maxim Fedorov">

  
  <meta name="description" content="Quite some time ago I ported one small project from Maven to SBT. Surprisingly this time I had troubles causing OutOfMemoryError after 5-8 cycles of &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://fedgehog.github.io/blog/2014/08/29/phoenix-build-tool">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Max's blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-58347916-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Max&#8217;s blog</a></h1>
  
    <h2>Firmitas, Utilitas, Venustas</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="fedgehog.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Phoenix Build Tool</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-29T06:09:26+03:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>6:09 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Quite some time ago I ported one small project from Maven to SBT. Surprisingly this time I had troubles causing OutOfMemoryError after 5-8 cycles of tests in continuous execution mode. After hour or two of OOMEs I even thought of Maven being a good build tool. But that feeling didn’t last long :).</p>

<p>After some playing with tests and code discovery happened that what I actually faced was so called referred pain. Referred pain is one that perceived at a location other than the site of actual cause.</p>

<p>And actual cause of pain was that dependencies on classes from OSS libraries used in project were declared in static way, what lead to heap polluted and finally caused OOMEs. Using Maven you typically won’t see this problem because each mvn invocation starts new process that ends right after execution of requested commands. SBT in contrary offers you interactive session, which is long lived, thus causing you to suffer eventually in case of careless resource management. Additionally SBT behaves oddly in case of OOME, so oddly that I couldn’t just stop process by hitting in terminal Ctrl+C and had to use process manager for these purposes. Which involved too much of annoying handwaving as for me.</p>

<p>So before treating real problem I decided to put a band-aid and automate a bit this process of killing-then-restarting-sbt-session.</p>

<p>Thus Phoenix Build Tool script born. Why Phoenix? Cause it reminds me a story about Phoenix bird that reborns arising from ashes left after it’s predecessor. But nowadays magic is not so popular as it used to be. So our phoenix is reborn with a little help of Functional Programming and Unix tools:</p>

<figure class='code'><figcaption><span>pbt.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">alias </span><span class="nv">pbt</span><span class="o">=</span><span class="s2">&quot;(ps T | grep sbt | grep -v grep | awk &#39;{print \$1}&#39; | xargs kill -KILL) &amp;&amp; sbt&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>What it does is following:</p>

<p>Reports all processes associated with current terminal
Filters out only sbt processes
Plucks process identifiers
Kills processes by plucked identifiers
Starts fresh SBT session if all previous steps succeeded</p>

<p>However there is one peculiarity, you need to suspend process (using Ctrl+Z) to initiate this script.</p>

<p>But for me it was a huge time-saver already which allowed to adapt application design and see immediate feedback on changes.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Maxim Fedorov</span></span>

      




<time class='entry-date' datetime='2014-08-29T06:09:26+03:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>6:09 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/sbt/'>sbt</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://fedgehog.github.io/blog/2014/08/29/phoenix-build-tool/" data-via="fedgehog" data-counturl="http://fedgehog.github.io/blog/2014/08/29/phoenix-build-tool/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/08/29/phoenix-build-tool/">Phoenix Build Tool</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/fedgehog">@fedgehog</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'fedgehog',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/+MaximFedorov?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Maxim Fedorov -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'fedgehog-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://fedgehog.github.io/blog/2014/08/29/phoenix-build-tool/';
        var disqus_url = 'http://fedgehog.github.io/blog/2014/08/29/phoenix-build-tool/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
